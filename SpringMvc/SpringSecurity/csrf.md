

### **1. What is CSRF?**

#### **Definition**  
CSRF (Cross-Site Request Forgery) is a type of malicious attack where a bad actor tricks a user into performing actions they didn’t intend to on a trusted website where they are authenticated.

---

### **2. Key Concepts and Definitions**

#### **2.1 Cross-Site Request Forgery (CSRF)**  
A CSRF attack occurs when:
1. A user is logged into a website (e.g., a banking app).
2. The attacker tricks the user into making an unwanted request to the website, such as transferring money.

---

#### **2.2 CSRF Token**  
A CSRF token is a unique, unpredictable value generated by the server and included in forms or requests. It ensures that the request originated from the authenticated user.

---

### **3. Why is CSRF Dangerous?**

1. **Exploitation of Trust:**  
   The server trusts the user’s session because they are authenticated.

2. **Actions Without Consent:**  
   The attacker can perform harmful actions like transferring funds or changing user settings without the user's knowledge.

---

### **4. How Does a CSRF Attack Work?**

#### Step-by-Step Process:  

1. **User Login:**  
   A user logs into a trusted website (e.g., their bank account) and a session is created.

2. **Session Cookie:**  
   The browser stores a session cookie for the user to remain logged in.

3. **Malicious Link or Form:**  
   The attacker tricks the user into clicking a link or submitting a form that points to the trusted website.

4. **Unwanted Action:**  
   The trusted website processes the malicious request because the browser automatically sends the session cookie.

---

#### **Real-World Analogy:**  
Imagine you give someone your signed blank cheque (cookie). If they secretly write an amount and submit it to your bank, the bank will process it because your signature (cookie) is valid.

---

### **5. How CSRF Tokens Prevent Attacks**

#### **The Role of CSRF Tokens:**

1. **Unique Token Generation:**  
   When a user accesses a page with a form, the server generates a CSRF token and embeds it in the form.

2. **Validation on Submission:**  
   When the form is submitted, the server checks the CSRF token against the one it generated earlier.  

3. **Invalid Tokens:**  
   If the token is missing or invalid, the request is rejected.

---

#### **Visualization of CSRF Token Flow:**

```
User Request -> Server Generates CSRF Token -> Token Added to Form
User Submits Form with Token -> Server Validates Token -> Request Processed
```

---

### **6. Why Use CSRF Tokens Every Time**

1. **Ensure Authenticity of Requests:**  
   CSRF tokens verify that the request is made intentionally by the user, not by a third party.

2. **Prevent Automated Attacks:**  
   Attackers cannot predict or reuse valid CSRF tokens, making automated attacks impossible.

3. **Session Independence:**  
   Even if an attacker gains access to a session cookie, they cannot forge a valid request without the CSRF token.

---

### **7. Example in Spring Security**

#### **Configuration for CSRF Protection:**

```java
@Override
protected void configure(HttpSecurity http) throws Exception {
    http
        .csrf()
        .csrfTokenRepository(CookieCsrfTokenRepository.withHttpOnlyFalse())
        .and()
        .authorizeRequests()
        .antMatchers("/login", "/register").permitAll()
        .anyRequest().authenticated();
}
```

---

#### **CSRF Token in an HTML Form:**

```html
<form action="/submit" method="POST">
    <input type="hidden" name="_csrf" value="generated_token">
    <input type="text" name="data">
    <button type="submit">Submit</button>
</form>
```

---

### **8. Real-World Example**

#### Scenario:  
A banking website where a user transfers money.

1. **Without CSRF Token:**  
   An attacker sends a hidden form to the user. When the user submits it unknowingly, the bank transfers money.

2. **With CSRF Token:**  
   The attacker cannot generate a valid CSRF token, so their request is rejected.

---

### **9. Related Topics**

#### **9.1 Same-Origin Policy:**  
The browser ensures that requests from a different domain cannot access certain resources, which adds a layer of security.

#### **9.2 XSS (Cross-Site Scripting):**  
Attackers can inject malicious scripts into web pages. If combined with CSRF vulnerabilities, it becomes more dangerous.

---

### **10. Tips and Best Practices**

1. **Enable CSRF Protection by Default:**  
   In Spring Security, CSRF protection is enabled automatically for web applications.

2. **Use HTTPS:**  
   Encrypt traffic to prevent token exposure.

3. **Secure APIs Differently:**  
   Use techniques like JWT or API keys for stateless applications.

4. **Educate Users:**  
   Warn users against clicking on unknown links or opening suspicious emails.

---

